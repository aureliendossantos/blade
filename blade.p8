pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	tab = 2
	camy = 0
	current_quest = 1
	phase = "quest"
	index = {1, 1, 1}
	chosen = {0, 0, {}}
	init_database()
	init_materials_win()
	init_weapon_win()
	init_quest_win()
end

function move_index(i, max_i)
	if btnp(⬆️) then
		i = max(1, i-1)
	end
	if btnp(⬇️) then
		i = min(i+1, max_i)
	end
	return i
end

function _update60()
	--deplacement index
	if popup then
		popup.index = move_index(popup.index, #popup.choices)
	elseif phase == "materials" then
		local max = {#blueprints, #materials, #enchants}
		index[tab] = move_index(index[tab], max[tab])
	end
	---
	if chosen[2] != 0 then
		can_forge = true
	else
		can_forge = false
	end
	if btn(❎) and btn(🅾️) and phase == "materials" and can_forge then
		create_popup("use these resources?", "forge", "cancel")
	end
	if btnp(❎) then
		if popup then
			popup = nil	
		elseif phase == "quest" then
			phase = "materials"
		elseif phase == "materials" then
			if tab == 1 or tab == 2 then
				chosen[tab] = index[tab]
			else
				already_enchanted = false
				for i in all(chosen[tab]) do
					if (i == index[tab]) already_enchanted = true
				end
				if (not already_enchanted) add(chosen[tab], index[tab])
			end
		end
	end
	if btnp(🅾️) then
		if phase == "materials" and tab == 3 then
			del(chosen[tab], index[tab])
		end
	end
	if phase == "materials" then
		if (btnp(⬅️)) tab = max(1, tab-1)
		if (btnp(➡️)) tab = min(3, tab+1)
	end
	--update current weapon stats
	local atk, wgt, sol, price, enc = 0, 0, 0, 0, {}
	if chosen[2] != 0 then
		atk += materials[chosen[2]].atk
		price += materials[chosen[2]].price
	end
	for i in all(chosen[3]) do
		price += enchants[i].price
		enc = chosen[3]
	end
	current_weapon = {atk = atk, wgt = wgt, sol = sol, price = price, enc = enc}
end

function _draw()
	cls()
	draw_materials_win()
	draw_weapon_win()
	if phase == "quest" then
		draw_quest_win()
	end
	if can_forge then
		print("❎+🅾️ forge", 80, 118, 7)
	end
	draw_popup()
end
-->8
--includes

#include windows.lua
#include database.lua
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000066000000088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000999000066000000008000000330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000009999000000066000008000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700009990000666066000008000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000666000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666666666000000000000000000000000000000000000000006666666666600000000000000000000000000000000000000006666666666600000000000000
61111111111656666666666066666666660000000666666666561111111111165666666666000000066666666660666666666561111111111160000000000000
61166661111601111111111611111111116000006111111111061111111611160111111111600000611111111116111111111061111161111160000000000000
61116116111601111116111611116111116000006116666111061111116111160111611111600000611666611116111111161061116111611160000000000000
61116116111601111161111611611161116000006111611611061116161111160161116111600000611161161116111111611061111161111160000000000000
61116116111601161611111611116111116000006111611611061111611111160111611111600000611161161116111616111061116111611160000000000000
61111666611600005000000600500050005000005000500500061116161111160050005000500000500050050005000050000061111161111160000000000000
61111111111600000000000000000000000000000000000000061111111111160000000000000000000000000000000000000061111111111160000000000000
