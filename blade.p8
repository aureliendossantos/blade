pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
 t,f=true,false
 tab=true
 cur_qu=1
 create_popup(
 "use these resources?","forge",
 "cancel")
 init_database()
 init_mat_win()
 init_qu_win()
end

function _update60()
	if btnp(⬆️) then
		if popup then
			popup.index=max(1,
			popup.index-1)
		end
	end
	if btnp(⬇️) then
		if popup then
			popup.index=min(
			popup.index+1,#popup.choices)
		end
	end
	if btnp(🅾️) then
		tab=not tab
	end
end

function _draw()
 cls()
 draw_mat_win()
 draw_qu_win()
	draw_popup()
end
-->8
--windows

-----------------------------
--common background & title--
-----------------------------

function draw_win_bg(win)
	local x,y,w,h,t=win.x,win.y,
	win.w,win.h,win.t
	rectfill(x+2,y+2,x+w,y+h,0)
	rectfill(x+1,y+1,x+w-2,y+h-2,1)
 line(x+1,y,x+w-2,y,6)
 line(x+1,y+h-1,x+w-2,y+h-1)
 line(x,y+1,x,y+h-2)
 line(x+w-1,y+1,x+w-1,y+h-2)
 pset(x+2,y+2)
 pset(x+w-3,y+2)
 pset(x+2,y+h-3)
 pset(x+w-3,y+h-3)
 if t then
 	print(t,x+w/2-#t*4/2,y+6,6)
 end
end

----------
--popups--
----------

function create_popup(question,
...)
 local c={...}
 local width=#question*4+12
 local height=15+#c*12
	popup={
	 x=64-width/2,
	 y=64-height/2,
	 w=width,
	 h=height,
	 t=question,
	 choices=c,
	 index=1
	}
end

function draw_popup()
	if popup then
		draw_win_bg(popup)
		local c=popup.choices
		local w=0
		for i=1,#c do
			local test=#c[i]*4+8
			w=test>w and test or w
		end
		for i=1,#c do
			local h=8
			local x=64-w/2
			local y=popup.y+15+(i-1)*(h+2)
			rectfill(x,y,x+w,y+h,0)
		 rect(x,y,x+w,y+h,
		 popup.index==i and 6 or 5)
			print(c[i],65-#c[i]*2,y+2,
			popup.index==i and 6 or 5)
		end
	end
end

------------------------
--materials & enchants--
------------------------

function init_mat_win()
	mat_win={x=0,y=7,w=75,h=121}
end

function draw_mat_win()
	draw_win_bg(mat_win)
	spr(tab and 48 or 51,4,0,3,1)
	local c=materials
	if not tab then
	 c=enchants
	end
	for i=1,#c do
	 local w=68
		local h=16
		local x=3
		local y=11+(i-1)*(h+2)
		rectfill(x,y,x+w,y+h,0)
	 rect(x,y,x+w,y+h,5)
	 spr(c[i].icon,x+3,y+4)
	 print(c[i].t1,x+13,y+3,6)
	 print(c[i].t2,x+13,y+9,5)
	 local g=tostr(c[i].g)
	 local gx=x+w-#g*4
	 print(g,gx-1,y+9,6)
	 spr(54,gx-6,y+7)
	end
end

---------
--quest--
---------

function init_qu_win()
	qu_win={x=30,y=11,w=75,h=101,
	t=quests[cur_qu].t1}
end

function draw_qu_win()
	draw_win_bg(qu_win)
	local q=quests[cur_qu]
	local x=qu_win.x+4
	local y=qu_win.y+20
	local w=qu_win.w
	print(q.t2,x,y,7)
	local s="-requirements-"
	print(s,x-4+w/2-#s*2,y+30,6)
	y+=40
	s="ATK:14"
	print(s,x,y,6)
	spr(55,x+#s*4,y)
	y+=7
	print("WGT:8",x,y,6)
	y+=7
	s="SOL:11"
	print(s,x,y,6)
	spr(55,x+#s*4,y)
	y+=8
	spr(4,x-2,y-2)
	print("pOISONOUS",x+6,y,6)
	y+=7
	spr(3,x-2,y-2)
	print("fIRE rEPEL",x+6,y,6)
end
-->8
--database

function init_database()
	materials={
	 {
	  t1="lEATHER",
	  t2="+8 DEF",
	  g=60,
	  icon=1
	 },
	 {
	  t1="sTIFF lEATHER",
	  t2="+12 DEF",
	  g=80,
	  icon=1
	 },
	 {
	  t1="tHICK lEATHER",
	  t2="+20 DEF",
	  g=115,
	  icon=1
	 },
	 {
	  t1="sCALE iRON",
	  t2="+18 ATK",
	  g=210,
	  icon=2
	 }
	}
	enchants={
	 {
	  t1="fIRE rEPEL",
	  t2="rEQ.iRON",
	  g=450,
	  icon=3
	 },
	 {
	  t1="pOISONOUS",
	  t2="rEQ.bLADE",
	  g=450,
	  icon=4
	 }
	}
	quests={
	 {
	  t1="pOISONOUS sWORD",
	  t2=
[[…WE NEED A NEW
STRATEGY TO TAKE
OVER THIS WAR.
PLEASE HELP US!]],
	  atk=16,
	  poison=true
	 }
	}
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000066000000088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000999000066000000008000000330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000009999000000066000008000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700009990000666066000008000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000666000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666666666600000000000000000000000066666666666000000000090000000330000000000000000000000000000000000000000000000000000000000000
61111111111165666666666006666666665611111111111600000000999000000030000000000000000000000000000000000000000000000000000000000000
61111111611160111111111661111111110611111611111600000000090000003000000000000000000000000000000000000000000000000000000000000000
61111116111160111611111661111111610611161116111600000000000000000000000000000000000000000000000000000000000000000000000000000000
61116161111160161116111661111116110611111611111600900000000000000000000000000000000000000000000000000000000000000000000000000000
61111611111160111611111661116161110611161116111600000000000000000000000000000000000000000000000000000000000000000000000000000000
61116161111160050005000550000500000611111611111609090000000000000000000000000000000000000000000000000000000000000000000000000000
61111111111160000000000000000000000611111111111600000000000000000000000000000000000000000000000000000000000000000000000000000000
