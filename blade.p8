pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	tab=true
	cur_qu=1
	phase="quest"
	mat_index,enc_index=1,1
	chosen_mat,chosen_enc=0,0
	init_database()
	init_materials_win()
	init_weapon_win()
	init_quest_win()
end

function move_index(i, max_i)
	if btnp(‚¨ÜÔ∏è) then
		return max(1, i-1)
	end
	if btnp(‚¨áÔ∏è) then
		return min(i+1, max_i)
	end
end

function _update60()
	--deplacement index
	if popup then
		popup.index = move_index(popup.index, #popup.choices)
	elseif phase=="materials" then
		if tab then
			mat_index = move_index(mat_index, #materials)
			else
			enc_index = move_index(mat_index, #enchants)
		end
	end
	---
	if chosen_mat!=0 then
		can_forge=true
	else
		can_forge=false
	end
	if btn(‚ùé) and btn(üÖæÔ∏è) and phase=="materials" and can_forge then
		create_popup("use these resources?","forge","cancel")
	end
	if btnp(‚ùé) then
		if phase=="quest" then
			phase="materials"
		elseif phase=="materials" then
			if tab then
			 chosen_mat=mat_index
			elseif chosen_mat!=0 then
				chosen_enc=enc_index
			end
		end
	end
	if btnp(üÖæÔ∏è) then
		if phase=="materials"
		and not tab then
			chosen_enc=0
		end
	end
	if btnp(‚¨ÖÔ∏è) or btnp(‚û°Ô∏è) then
		if phase=="materials" then
			tab=not tab
		end
	end
	--update weapon stats
	local atk,wgt,sol=0,0,0
	if chosen_mat!=0 then
		atk+=materials[chosen_mat].atk
	end
	cur_wep.atk,cur_wep.wgt,
	cur_wep.sol=atk,wgt,sol
end

function _draw()
	cls()
	draw_materials_win()
	draw_weapon_win()
	if phase=="quest" then
		draw_quest_win()
	end
	if can_forge then
		print("‚ùé+üÖæÔ∏è forge",80,118,7)
	end
	draw_popup()
end

#include windows.lua
#include database.lua
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000066000000088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000999000066000000008000000330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000009999000000066000008000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700009990000666066000008000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000666000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666666666600000000000000000000000066666666666000000000090000000330000000000000000000000000000000000000000000000000000000000000
61111111111165666666666006666666665611111111111600000000999000000030000000000000000000000000000000000000000000000000000000000000
61111111611160111111111661111111110611111611111600000000090000003000000000000000000000000000000000000000000000000000000000000000
61111116111160111611111661111111610611161116111600000000000000000000000000000000000000000000000000000000000000000000000000000000
61116161111160161116111661111116110611111611111600900000000000000000000000000000000000000000000000000000000000000000000000000000
61111611111160111611111661116161110611161116111600000000000000000000000000000000000000000000000000000000000000000000000000000000
61116161111160050005000550000500000611111611111609090000000000000000000000000000000000000000000000000000000000000000000000000000
61111111111160000000000000000000000611111111111600000000000000000000000000000000000000000000000000000000000000000000000000000000
